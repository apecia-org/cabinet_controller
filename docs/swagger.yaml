openapi: 3.0.3
info:
  title: Cabinet Control API
  version: 1.0.0
  description: RESTful API service for controlling cabinets via serial port communication
  contact:
    name: API Support
  license:
    name: MIT

servers:
  - url: http://localhost:80
    description: Local development server

tags:
  - name: Cabinet
    description: Cabinet control operations
  - name: Health
    description: Service health check

paths:
  /api/v1/health:
    get:
      tags:
        - Health
      summary: Health check endpoint
      description: Returns the health status of the API service
      operationId: getHealth
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: healthy
                timestamp: '2025-11-13T15:30:00.000Z'
                service: cabinet-api
                version: 1.0.0

  /api/v1/cabinet/status:
    get:
      tags:
        - Cabinet
      summary: Get all cabinet statuses
      description: Returns the status of all cabinets including open/close state and timestamps
      operationId: getCabinetStatus
      parameters:
        - name: fresh
          in: query
          description: If true, requests fresh status from hardware
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Successfully retrieved cabinet statuses
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
              example:
                status: success
                data:
                  cabinets:
                    - id: 1
                      status: opened
                      timestamp: '2025-11-13T15:25:00.000Z'
                    - id: 2
                      status: opened
                      timestamp: '2025-11-13T15:25:01.000Z'
                  totalCabinets: 2
                  openedCount: 2
                timestamp: '2025-11-13T15:30:00.000Z'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/cabinet/open:
    post:
      tags:
        - Cabinet
      summary: Open selected cabinets
      description: Opens specified cabinets by sending serial commands
      operationId: openCabinets
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OpenCabinetsRequest'
            examples:
              single:
                summary: Open single cabinet
                value:
                  cabinetIds: [1]
              multiple:
                summary: Open multiple cabinets
                value:
                  cabinetIds: [1, 2, 3, 5, 8]
      responses:
        '200':
          description: Cabinets opened successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OpenCabinetsResponse'
              example:
                status: success
                message: Cabinet operation completed
                data:
                  opened: [1, 2, 3]
                  failed: []
                  total: 3
                  successCount: 3
                  failureCount: 0
                timestamp: '2025-11-13T15:30:00.000Z'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingField:
                  summary: Missing cabinetIds field
                  value:
                    status: error
                    message: cabinetIds is required and must be an array
                emptyArray:
                  summary: Empty array
                  value:
                    status: error
                    message: cabinetIds array cannot be empty
                invalidType:
                  summary: Invalid data type
                  value:
                    status: error
                    message: All cabinetIds must be numbers
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/cabinet/reset:
    post:
      tags:
        - Cabinet
      summary: Reset cabinet status tracking
      description: Clears all cabinet status history
      operationId: resetCabinets
      responses:
        '200':
          description: Cabinet status reset successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResetResponse'
              example:
                status: success
                message: Cabinet status tracking reset
                timestamp: '2025-11-13T15:30:00.000Z'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    HealthResponse:
      type: object
      required:
        - status
        - timestamp
        - service
        - version
      properties:
        status:
          type: string
          enum: [healthy]
          description: Health status of the service
        timestamp:
          type: string
          format: date-time
          description: Current server timestamp
        service:
          type: string
          description: Service name
          example: cabinet-api
        version:
          type: string
          description: API version
          example: 1.0.0

    StatusResponse:
      type: object
      required:
        - status
        - data
        - timestamp
      properties:
        status:
          type: string
          enum: [success]
          description: Response status
        data:
          type: object
          required:
            - cabinets
            - totalCabinets
            - openedCount
          properties:
            cabinets:
              type: array
              description: List of cabinets with their statuses
              items:
                $ref: '#/components/schemas/CabinetStatus'
            totalCabinets:
              type: integer
              description: Total number of cabinets tracked
            openedCount:
              type: integer
              description: Number of cabinets that have been opened
        timestamp:
          type: string
          format: date-time
          description: Response timestamp

    CabinetStatus:
      type: object
      required:
        - id
        - status
        - timestamp
      properties:
        id:
          type: integer
          description: Cabinet identifier
          example: 1
        status:
          type: string
          enum: [opened, closed]
          description: Current status of the cabinet
        timestamp:
          type: string
          format: date-time
          description: When the cabinet was last opened

    OpenCabinetsRequest:
      type: object
      required:
        - cabinetIds
      properties:
        cabinetIds:
          type: array
          description: Array of cabinet IDs to open
          minItems: 1
          items:
            type: integer
            minimum: 0
            maximum: 255
          example: [1, 2, 3]

    OpenCabinetsResponse:
      type: object
      required:
        - status
        - message
        - data
        - timestamp
      properties:
        status:
          type: string
          enum: [success]
          description: Response status
        message:
          type: string
          description: Success message
        data:
          type: object
          required:
            - opened
            - failed
            - total
            - successCount
            - failureCount
          properties:
            opened:
              type: array
              description: Array of cabinet IDs that were successfully opened
              items:
                type: integer
            failed:
              type: array
              description: Array of cabinet IDs that failed to open
              items:
                type: integer
            total:
              type: integer
              description: Total number of cabinets requested to open
            successCount:
              type: integer
              description: Number of cabinets successfully opened
            failureCount:
              type: integer
              description: Number of cabinets that failed to open
        timestamp:
          type: string
          format: date-time
          description: Operation timestamp

    ResetResponse:
      type: object
      required:
        - status
        - message
        - timestamp
      properties:
        status:
          type: string
          enum: [success]
          description: Response status
        message:
          type: string
          description: Success message
        timestamp:
          type: string
          format: date-time
          description: Operation timestamp

    ErrorResponse:
      type: object
      required:
        - status
        - message
      properties:
        status:
          type: string
          enum: [error]
          description: Error status
        message:
          type: string
          description: Error message
        error:
          type: string
          description: Detailed error information
